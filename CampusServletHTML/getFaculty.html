<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Faculty List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#facultyModal">
     Add New Faculty
    </button>
   
  </div>

  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Faculty Name</th>
        <th>Remarks</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="facultyTableBody">
     
    </tbody>
  </table>
</div>

<!-- Modal for Add Faculty -->
<div class="modal fade" id="facultyModal" tabindex="-1" aria-labelledby="facultyModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="facultyForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="facultyModalLabel">Add New Faculty</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="facultyName" class="form-label">Faculty Name</label>
          <input type="text" class="form-control" id="facultyName" required>
        </div>
        <div class="mb-3">
          <label for="remarks" class="form-label">Remarks</label>
          <input type="text" class="form-control" id="remarks">
        </div>
      </div>
      <div class="modal-footer">
        <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary" id="submitButton">Save</button>
      </div>
    </form>
  </div>
</div>

 <!-- Edit Faculty Modal -->
<div class="modal fade" id="editFacultyModal" tabindex="-1" aria-labelledby="editFacultyModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="editFacultyForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editFacultyModalLabel">Edit Faculty</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editFacultyId">
        <div class="mb-3">
          <label for="editFacultyName" class="form-label">Faculty Name</label>
          <input type="text" class="form-control" id="editFacultyName" required>
        </div>
        <div class="mb-3">
          <label for="editRemarks" class="form-label">Remarks</label>
          <input type="text" class="form-control" id="editRemarks">
        </div>
      </div>
      <div class="modal-footer">
        <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary" id="updateButton">Update</button>
      </div>
    </form>
  </div>
</div>



<script>

  function loadFaculties() {
  const tbody = document.getElementById("facultyTableBody");
  tbody.innerHTML = ""; 

  fetch('http://localhost:8080/CampusServletProject/getFaculty')
    .then(response => response.json())
    .then(data => {
      data.forEach(faculty => {
        const row = document.createElement("tr");
        row.innerHTML = `
        <td>${faculty.id}</td>
        <td>${faculty.name}</td>
        <td>${faculty.remarks}</td>
        <td>
          <button class="btn btn-sm btn-warning me-1 edit-btn" 
                  data-id="${faculty.id}" 
                  data-name="${faculty.name}" 
                  data-remarks="${faculty.remarks}">
            Edit
          </button>
          <button class="btn btn-sm btn-danger delete-btn" data-id="${faculty.id}">Delete</button>
        </td>`;

        tbody.appendChild(row);
      });
    })
    .catch(error => {
      console.log("Error fetching data:", error);
    });
}


loadFaculties();


// ADD FACULTY
document.getElementById("facultyForm").addEventListener("submit", function (e) {
  e.preventDefault();

  const facultyName = document.getElementById("facultyName").value;
  const remarks = document.getElementById("remarks").value;

  fetch('http://localhost:8080/CampusServletProject/addFaculty', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ name: facultyName, remarks: remarks })
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Failed to add faculty');
    }
    return response.json();
  })
  .then(data => {
    console.log("Faculty added:", data);

    document.getElementById("facultyForm").reset();
    const modal = bootstrap.Modal.getInstance(document.getElementById('facultyModal'));
    modal.hide();

   
    loadFaculties();
  })
  .catch(error => {
    console.error("Error adding faculty:", error);
    alert("Something went wrong while adding faculty.");
  });
});


//Edit Faculty Popup Model
document.addEventListener("click", function (e) {
    if (e.target && e.target.classList.contains("edit-btn")) {
      const id = e.target.getAttribute("data-id");
      const name = e.target.getAttribute("data-name");
      const remarks = e.target.getAttribute("data-remarks");

      document.getElementById("editFacultyId").value = id;
      document.getElementById("editFacultyName").value = name;
      document.getElementById("editRemarks").value = remarks;

      const editModal = new bootstrap.Modal(document.getElementById("editFacultyModal"));
      editModal.show();
    }
  });

 document.getElementById("editFacultyForm").addEventListener("submit", function (e) {
  e.preventDefault();

  const id = parseInt(document.getElementById("editFacultyId").value);
  const facultyName = document.getElementById("editFacultyName").value;
  const remarks = document.getElementById("editRemarks").value;

  //Update Faculty Data
  fetch('http://localhost:8080/CampusServletProject/updateFaculty', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ id: id, name: facultyName, remarks: remarks })
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Failed to update faculty');
    }
    return response.json();
  })
  .then(data => {
    console.log("Faculty updated:", data);

    document.getElementById("editFacultyForm").reset();
    const modal = bootstrap.Modal.getInstance(document.getElementById('editFacultyModal'));
    modal.hide();

    loadFaculties();
  })
  .catch(error => {
    console.error("Error updating faculty:", error);
    alert("Something went wrong while updating faculty.");
  });
});


//Delete Faculty
document.addEventListener("click", function (e) {
  if (e.target && e.target.classList.contains("delete-btn")) {
    const id = parseInt(e.target.getAttribute("data-id"));

    if (confirm("Are you sure you want to delete this faculty?")) {
      fetch(`http://localhost:8080/CampusServletProject/deleteFaculty?id=${id}`, {
        method: "DELETE"
      })
      .then(response => {
        if (!response.ok) {
          throw new Error("Failed to delete faculty");
        }
        return response.json();
      })
      .then(data => {
        console.log("Faculty deleted:", data);
        loadFaculties(); 
      })
      .catch(error => {
        console.error("Error deleting faculty:", error);
        alert("Something went wrong while deleting faculty.");
      });
    }
  }
});


</script>


</body>
</html>